[2022-12-28 21:37:47,036.036] INFO [139824743212864] - Will watch for changes in these directories: ['/usr/src']
[2022-12-28 21:37:47,046.046] INFO [139824743212864] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2022-12-28 21:37:47,062.062] INFO [139824743212864] - Started reloader process [1] using StatReload
[2022-12-28 21:37:57,901.901] INFO [140544838731584] - Started server process [8]
[2022-12-28 21:37:57,910.910] INFO [140544838731584] - Waiting for application startup.
[2022-12-28 21:37:58,597.597] INFO [140544838731584] - Application startup complete.
[2022-12-28 21:39:24,476.476] ERROR [140544787097344] - Logging test
[2022-12-28 21:39:24,498.498] INFO [140544838731584] - 172.24.0.10:59906 - "GET / HTTP/1.0" 200
[2022-12-28 21:39:39,843.843] ERROR [140544787097344] - Logging test
[2022-12-28 21:39:39,848.848] INFO [140544838731584] - 172.24.0.1:61712 - "GET / HTTP/1.1" 200
[2022-12-28 21:40:23,123.123] ERROR [140544787097344] - Logging test
[2022-12-28 21:40:23,135.135] INFO [140544838731584] - 172.24.0.1:61722 - "GET / HTTP/1.1" 200
[2022-12-28 21:43:08,713.713] WARNING [139824743212864] - StatReload detected changes in 'gate/main.py'. Reloading...
[2022-12-28 21:43:08,880.880] INFO [140544838731584] - Shutting down
[2022-12-28 21:43:08,993.993] INFO [140544838731584] - Waiting for application shutdown.
[2022-12-28 21:43:09,037.037] INFO [140544838731584] - Application shutdown complete.
[2022-12-28 21:43:09,047.047] INFO [140544838731584] - Finished server process [8]
[2022-12-28 21:43:11,905.905] WARNING [139824743212864] - StatReload detected changes in 'gate/main.py'. Reloading...
[2022-12-28 21:43:14,278.278] INFO [140375778867008] - Started server process [14]
[2022-12-28 21:43:14,280.280] INFO [140375778867008] - Waiting for application startup.
[2022-12-28 21:43:14,763.763] INFO [140375778867008] - Application startup complete.
[2022-12-28 21:43:14,920.920] WARNING [139824743212864] - StatReload detected changes in 'gate/main.py'. Reloading...
[2022-12-28 21:43:14,983.983] INFO [140375778867008] - Shutting down
[2022-12-28 21:43:15,090.090] INFO [140375778867008] - Waiting for application shutdown.
[2022-12-28 21:43:15,094.094] INFO [140375778867008] - Application shutdown complete.
[2022-12-28 21:43:15,097.097] INFO [140375778867008] - Finished server process [14]
[2022-12-28 21:43:17,368.368] INFO [140544817231680] - Started server process [18]
[2022-12-28 21:43:17,371.371] INFO [140544817231680] - Waiting for application startup.
[2022-12-28 21:43:17,626.626] INFO [140544817231680] - Application startup complete.
[2022-12-28 21:43:37,465.465] INFO [140544817231680] - Shutting down
[2022-12-28 21:43:37,728.728] INFO [140544817231680] - Waiting for application shutdown.
[2022-12-28 21:43:38,469.469] INFO [140544817231680] - Application shutdown complete.
[2022-12-28 21:43:39,238.238] INFO [140544817231680] - Finished server process [18]
[2022-12-28 21:43:42,406.406] INFO [139824743212864] - Stopping reloader process [1]
[2023-01-09 07:21:04,505.505] INFO [140177504847680] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 07:21:04,507.507] INFO [140177504847680] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 07:21:04,508.508] INFO [140177504847680] - Started reloader process [1] using StatReload
[2023-01-09 07:21:10,557.557] INFO [140169768834880] - Started server process [8]
[2023-01-09 07:21:10,559.559] INFO [140169768834880] - Waiting for application startup.
[2023-01-09 07:21:11,054.054] ERROR [140169768834880] - Unable connect to "localhost:29092": Multiple exceptions: [Errno 111] Connect call failed ('127.0.0.1', 29092), [Errno 99] Cannot assign requested address
[2023-01-09 07:21:11,064.064] ERROR [140169768834880] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 28, in startup_event
    await kafka_producer.start()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/aiokafka/producer/producer.py", line 307, in start
    await self.client.bootstrap()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/aiokafka/client.py", line 251, in bootstrap
    raise KafkaConnectionError(
kafka.errors.KafkaConnectionError: KafkaConnectionError: Unable to bootstrap from [('localhost', 29092, <AddressFamily.AF_UNSPEC: 0>)]

[2023-01-09 07:21:11,112.112] ERROR [140169768834880] - Application startup failed. Exiting.
[2023-01-09 07:37:01,639.639] INFO [140177504847680] - Stopping reloader process [1]
[2023-01-09 07:37:14,964.964] INFO [140009608128320] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 07:37:14,970.970] INFO [140009608128320] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 07:37:14,974.974] INFO [140009608128320] - Started reloader process [1] using StatReload
[2023-01-09 07:37:24,227.227] INFO [140245910832960] - Started server process [8]
[2023-01-09 07:37:24,239.239] INFO [140245910832960] - Waiting for application startup.
[2023-01-09 07:37:26,198.198] ERROR [140245910832960] - Unable connect to "localhost:29092": Multiple exceptions: [Errno 111] Connect call failed ('127.0.0.1', 29092), [Errno 99] Cannot assign requested address
[2023-01-09 07:37:26,243.243] ERROR [140245910832960] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 28, in startup_event
    await kafka_producer.start()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/aiokafka/producer/producer.py", line 307, in start
    await self.client.bootstrap()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/aiokafka/client.py", line 251, in bootstrap
    raise KafkaConnectionError(
kafka.errors.KafkaConnectionError: KafkaConnectionError: Unable to bootstrap from [('localhost', 29092, <AddressFamily.AF_UNSPEC: 0>)]

[2023-01-09 07:37:26,289.289] ERROR [140245910832960] - Application startup failed. Exiting.
[2023-01-09 07:37:36,313.313] INFO [140009608128320] - Stopping reloader process [1]
[2023-01-09 07:54:34,511.511] INFO [139968378054464] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 07:54:34,513.513] INFO [139968378054464] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 07:54:34,515.515] INFO [139968378054464] - Started reloader process [1] using StatReload
[2023-01-09 07:54:45,378.378] INFO [139699599255360] - Started server process [9]
[2023-01-09 07:54:45,385.385] INFO [139699599255360] - Waiting for application startup.
[2023-01-09 07:55:18,409.409] ERROR [139699599255360] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 35, in startup_event
    mng_db.aio_mongo_client_session = await mng_db.aio_mongo_client.start_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/frameworks/asyncio/__init__.py", line 137, in _wrapper
    result = await f(self, *args, **kwargs)
  File "/usr/local/lib/python3.9/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1715, in start_session
    return self.__start_session(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1688, in __start_session
    server_session = self._get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1724, in _get_server_session
    return self._topology.get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 566, in get_server_session
    session_timeout = self._check_session_support()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: mongors1n1:27017: [Errno -2] Name or service not known, Timeout: 30s, Topology Description: <TopologyDescription id: 63bbc8463e11a87164e7be17, topology_type: Unknown, servers: [<ServerDescription ('mongors1n1', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('mongors1n1:27017: [Errno -2] Name or service not known')>]>

[2023-01-09 07:55:18,977.977] ERROR [139699599255360] - Application startup failed. Exiting.
[2023-01-09 07:58:48,583.583] WARNING [139968378054464] - StatReload detected changes in 'db/mongo/mng_config.py'. Reloading...
[2023-01-09 07:58:52,210.210] INFO [140698087630656] - Started server process [15]
[2023-01-09 07:58:52,212.212] INFO [140698087630656] - Waiting for application startup.
[2023-01-09 08:02:32,206.206] INFO [140179660990272] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:02:32,212.212] INFO [140179660990272] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:02:32,214.214] INFO [140179660990272] - Started reloader process [1] using StatReload
[2023-01-09 08:02:37,733.733] ERROR [140631083272000] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:02:38,313.313] INFO [140631083272000] - Started server process [9]
[2023-01-09 08:02:38,317.317] INFO [140631083272000] - Waiting for application startup.
[2023-01-09 08:03:09,022.022] ERROR [140631083272000] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 39, in startup_event
    mng_db.aio_mongo_client_session = await mng_db.aio_mongo_client.start_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/frameworks/asyncio/__init__.py", line 137, in _wrapper
    result = await f(self, *args, **kwargs)
  File "/usr/local/lib/python3.9/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1715, in start_session
    return self.__start_session(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1688, in __start_session
    server_session = self._get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1724, in _get_server_session
    return self._topology.get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 566, in get_server_session
    session_timeout = self._check_session_support()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: mongors1n1:27017: [Errno -2] Name or service not known, Timeout: 30s, Topology Description: <TopologyDescription id: 63bbca1ead029550f4f3bcd9, topology_type: Unknown, servers: [<ServerDescription ('mongors1n1', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('mongors1n1:27017: [Errno -2] Name or service not known')>]>

[2023-01-09 08:03:09,280.280] ERROR [140631083272000] - Application startup failed. Exiting.
[2023-01-09 08:09:48,577.577] INFO [140179660990272] - Stopping reloader process [1]
[2023-01-09 08:14:11,817.817] INFO [140219136325440] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:14:11,820.820] INFO [140219136325440] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:14:11,827.827] INFO [140219136325440] - Started reloader process [1] using StatReload
[2023-01-09 08:14:27,958.958] ERROR [140613703812928] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:14:28,890.890] INFO [140613703812928] - Started server process [8]
[2023-01-09 08:14:28,896.896] INFO [140613703812928] - Waiting for application startup.
[2023-01-09 08:14:29,859.859] ERROR [140613703812928] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:15:02,317.317] ERROR [140613703812928] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 41, in startup_event
    mng_db.aio_mongo_client_session = await mng_db.aio_mongo_client.start_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/frameworks/asyncio/__init__.py", line 137, in _wrapper
    result = await f(self, *args, **kwargs)
  File "/usr/local/lib/python3.9/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1715, in start_session
    return self.__start_session(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1688, in __start_session
    server_session = self._get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1724, in _get_server_session
    return self._topology.get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 566, in get_server_session
    session_timeout = self._check_session_support()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: mongors1n1:27017: [Errno -2] Name or service not known, Timeout: 30s, Topology Description: <TopologyDescription id: 63bbcce5dedbe039377774b9, topology_type: Unknown, servers: [<ServerDescription ('mongors1n1', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('mongors1n1:27017: [Errno -2] Name or service not known')>]>

[2023-01-09 08:15:05,459.459] ERROR [140613703812928] - Application startup failed. Exiting.
[2023-01-09 08:16:15,801.801] INFO [140219136325440] - Stopping reloader process [1]
[2023-01-09 08:16:47,621.621] INFO [139818475038528] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:16:47,659.659] INFO [139818475038528] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:16:47,889.889] INFO [139818475038528] - Started reloader process [1] using StatReload
[2023-01-09 08:16:59,267.267] ERROR [139983986800448] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:16:59,784.784] INFO [139983986800448] - Started server process [8]
[2023-01-09 08:16:59,789.789] INFO [139983986800448] - Waiting for application startup.
[2023-01-09 08:17:00,314.314] ERROR [139983986800448] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:17:30,523.523] ERROR [139983986800448] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 41, in startup_event
    mng_db.aio_mongo_client_session = await mng_db.aio_mongo_client.start_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/frameworks/asyncio/__init__.py", line 137, in _wrapper
    result = await f(self, *args, **kwargs)
  File "/usr/local/lib/python3.9/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1715, in start_session
    return self.__start_session(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1688, in __start_session
    server_session = self._get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1724, in _get_server_session
    return self._topology.get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 566, in get_server_session
    session_timeout = self._check_session_support()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: mongors1n1:27017: [Errno -2] Name or service not known, Timeout: 30s, Topology Description: <TopologyDescription id: 63bbcd7cc2e021af6a2e0323, topology_type: Unknown, servers: [<ServerDescription ('mongors1n1', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('mongors1n1:27017: [Errno -2] Name or service not known')>]>

[2023-01-09 08:17:30,565.565] ERROR [139983986800448] - Application startup failed. Exiting.
[2023-01-09 08:20:22,341.341] INFO [139818475038528] - Stopping reloader process [1]
[2023-01-09 08:22:08,058.058] INFO [140590321133376] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:22:08,061.061] INFO [140590321133376] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:22:08,062.062] INFO [140590321133376] - Started reloader process [1] using StatReload
[2023-01-09 08:22:18,071.071] ERROR [140690817337152] - global
[2023-01-09 08:22:18,075.075] ERROR [140690817337152] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:22:18,875.875] INFO [140690817337152] - Started server process [7]
[2023-01-09 08:22:18,886.886] INFO [140690817337152] - Waiting for application startup.
[2023-01-09 08:22:19,339.339] ERROR [140690817337152] - startup
[2023-01-09 08:22:19,341.341] ERROR [140690817337152] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:22:19,499.499] ERROR [140690817337152] - mongo start
[2023-01-09 08:22:49,760.760] ERROR [140690817337152] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 45, in startup_event
    mng_db.aio_mongo_client_session = await mng_db.aio_mongo_client.start_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/frameworks/asyncio/__init__.py", line 137, in _wrapper
    result = await f(self, *args, **kwargs)
  File "/usr/local/lib/python3.9/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1715, in start_session
    return self.__start_session(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1688, in __start_session
    server_session = self._get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/mongo_client.py", line 1724, in _get_server_session
    return self._topology.get_server_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 566, in get_server_session
    session_timeout = self._check_session_support()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 554, in _check_session_support
    self._select_servers_loop(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/pymongo/topology.py", line 238, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: mongors1n1:27017: [Errno -2] Name or service not known, Timeout: 30s, Topology Description: <TopologyDescription id: 63bbcebb6f407a008f4721ef, topology_type: Unknown, servers: [<ServerDescription ('mongors1n1', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('mongors1n1:27017: [Errno -2] Name or service not known')>]>

[2023-01-09 08:22:49,862.862] ERROR [140690817337152] - Application startup failed. Exiting.
[2023-01-09 08:30:48,926.926] INFO [140590321133376] - Stopping reloader process [1]
[2023-01-09 08:34:23,305.305] INFO [139874913437504] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:34:23,308.308] INFO [139874913437504] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:34:23,316.316] INFO [139874913437504] - Started reloader process [1] using StatReload
[2023-01-09 08:34:28,491.491] ERROR [140287743964992] - global
[2023-01-09 08:34:28,496.496] ERROR [140287743964992] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:34:30,298.298] INFO [140287743964992] - Started server process [8]
[2023-01-09 08:34:30,328.328] INFO [140287743964992] - Waiting for application startup.
[2023-01-09 08:34:31,126.126] ERROR [140287743964992] - startup
[2023-01-09 08:34:31,134.134] ERROR [140287743964992] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:34:31,253.253] ERROR [140287743964992] - mongo start
[2023-01-09 08:34:31,295.295] ERROR [140287743964992] - routing init
[2023-01-09 08:34:31,395.395] ERROR [140287743964992] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 49, in startup_event
    from api.v1.routes import api_v1_router  # noqa
  File "/usr/src/gate/api/v1/routes.py", line 1, in <module>
    from api.v1.my_ugc_api import users, movies, reviews, ratings, bookmarks
  File "/usr/src/gate/api/v1/my_ugc_api/users.py", line 3, in <module>
    from service import ugc_storage as ugc
  File "/usr/src/gate/service/ugc_storage.py", line 9, in <module>
    from db.mongo.mng_db import db
ImportError: cannot import name 'db' from 'db.mongo.mng_db' (/usr/src/./db/mongo/mng_db.py)

[2023-01-09 08:34:31,406.406] ERROR [140287743964992] - Application startup failed. Exiting.
[2023-01-09 08:35:54,138.138] INFO [140561035298624] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:35:54,141.141] INFO [140561035298624] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:35:54,145.145] INFO [140561035298624] - Started reloader process [25] using StatReload
[2023-01-09 08:36:00,395.395] ERROR [140022492194624] - global
[2023-01-09 08:36:00,396.396] ERROR [140022492194624] - environ({'KAFKA_HOST': 'kafka', 'GROUP': 'gatekeeper', 'HOSTNAME': 'gate_api', 'PYTHON_VERSION': '3.9.16', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'PWD': '/usr/src', 'HOMEDIR': '/home/gatekeeper', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'APP_HOME': '/usr/src', 'HOME': '/home/gatekeeper', 'SENTRY_DSN': '', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'MONGODB_HOST': 'mongors1n1', 'PYTHONPATH': '/usr/src/gate:', 'TERM': 'xterm', 'USER': 'gatekeeper', 'SHLVL': '1', 'PYTHON_PIP_VERSION': '22.0.4', 'MONGODB_PORT': '27017', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/home/gatekeeper/.local/bin/uvicorn'})
[2023-01-09 08:36:01,950.950] INFO [140022492194624] - Started server process [27]
[2023-01-09 08:36:01,971.971] INFO [140022492194624] - Waiting for application startup.
[2023-01-09 08:36:02,817.817] ERROR [140022492194624] - startup
[2023-01-09 08:36:02,820.820] ERROR [140022492194624] - environ({'KAFKA_HOST': 'kafka', 'GROUP': 'gatekeeper', 'HOSTNAME': 'gate_api', 'PYTHON_VERSION': '3.9.16', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'PWD': '/usr/src', 'HOMEDIR': '/home/gatekeeper', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'APP_HOME': '/usr/src', 'HOME': '/home/gatekeeper', 'SENTRY_DSN': '', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'MONGODB_HOST': 'mongors1n1', 'PYTHONPATH': '/usr/src/gate:', 'TERM': 'xterm', 'USER': 'gatekeeper', 'SHLVL': '1', 'PYTHON_PIP_VERSION': '22.0.4', 'MONGODB_PORT': '27017', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/home/gatekeeper/.local/bin/uvicorn'})
[2023-01-09 08:36:02,933.933] ERROR [140022492194624] - mongo start
[2023-01-09 08:36:03,038.038] ERROR [140022492194624] - routing init
[2023-01-09 08:36:03,158.158] ERROR [140022492194624] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 645, in lifespan
    async with self.lifespan_context(app):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 540, in __aenter__
    await self._router.startup()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 622, in startup
    await handler()
  File "/usr/src/./gate/main.py", line 49, in startup_event
    from api.v1.routes import api_v1_router  # noqa
  File "/usr/src/gate/api/v1/routes.py", line 1, in <module>
    from api.v1.my_ugc_api import users, movies, reviews, ratings, bookmarks
  File "/usr/src/gate/api/v1/my_ugc_api/users.py", line 3, in <module>
    from service import ugc_storage as ugc
  File "/usr/src/gate/service/ugc_storage.py", line 9, in <module>
    from db.mongo.mng_db import db
ImportError: cannot import name 'db' from 'db.mongo.mng_db' (/usr/src/./db/mongo/mng_db.py)

[2023-01-09 08:36:03,201.201] ERROR [140022492194624] - Application startup failed. Exiting.
[2023-01-09 08:37:59,386.386] WARNING [140561035298624] - StatReload detected changes in 'gate/api/v1/routes.py'. Reloading...
[2023-01-09 08:37:59,398.398] WARNING [139874913437504] - StatReload detected changes in 'gate/api/v1/routes.py'. Reloading...
[2023-01-09 08:38:03,125.125] ERROR [140291591464768] - global
[2023-01-09 08:38:03,126.126] ERROR [140291591464768] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:38:03,127.127] ERROR [140687969662784] - global
[2023-01-09 08:38:03,134.134] ERROR [140687969662784] - environ({'KAFKA_HOST': 'kafka', 'GROUP': 'gatekeeper', 'HOSTNAME': 'gate_api', 'PYTHON_VERSION': '3.9.16', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'PWD': '/usr/src', 'HOMEDIR': '/home/gatekeeper', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'APP_HOME': '/usr/src', 'HOME': '/home/gatekeeper', 'SENTRY_DSN': '', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'MONGODB_HOST': 'mongors1n1', 'PYTHONPATH': '/usr/src/gate:', 'TERM': 'xterm', 'USER': 'gatekeeper', 'SHLVL': '1', 'PYTHON_PIP_VERSION': '22.0.4', 'MONGODB_PORT': '27017', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/home/gatekeeper/.local/bin/uvicorn'})
[2023-01-09 08:38:03,450.450] INFO [140687969662784] - Started server process [38]
[2023-01-09 08:38:03,458.458] INFO [140687969662784] - Waiting for application startup.
[2023-01-09 08:38:03,570.570] INFO [140291591464768] - Started server process [39]
[2023-01-09 08:38:03,586.586] INFO [140291591464768] - Waiting for application startup.
[2023-01-09 08:38:04,749.749] ERROR [140687969662784] - startup
[2023-01-09 08:38:04,750.750] ERROR [140687969662784] - environ({'KAFKA_HOST': 'kafka', 'GROUP': 'gatekeeper', 'HOSTNAME': 'gate_api', 'PYTHON_VERSION': '3.9.16', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'PWD': '/usr/src', 'HOMEDIR': '/home/gatekeeper', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'APP_HOME': '/usr/src', 'HOME': '/home/gatekeeper', 'SENTRY_DSN': '', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'MONGODB_HOST': 'mongors1n1', 'PYTHONPATH': '/usr/src/gate:', 'TERM': 'xterm', 'USER': 'gatekeeper', 'SHLVL': '1', 'PYTHON_PIP_VERSION': '22.0.4', 'MONGODB_PORT': '27017', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/home/gatekeeper/.local/bin/uvicorn'})
[2023-01-09 08:38:04,788.788] ERROR [140291591464768] - startup
[2023-01-09 08:38:04,791.791] ERROR [140291591464768] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:38:04,875.875] ERROR [140687969662784] - mongo start
[2023-01-09 08:38:04,883.883] ERROR [140291591464768] - mongo start
[2023-01-09 08:38:04,998.998] ERROR [140687969662784] - routing init
[2023-01-09 08:38:05,035.035] ERROR [140291591464768] - routing init
[2023-01-09 08:38:05,522.522] INFO [140291591464768] - Application startup complete.
[2023-01-09 08:38:05,536.536] INFO [140687969662784] - Application startup complete.
[2023-01-09 08:38:05,552.552] ERROR [140687969662784] - Traceback (most recent call last):
  File "/usr/local/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 647, in run_until_complete
    return future.result()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/server.py", line 77, in serve
    await self.startup(sockets=sockets)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/server.py", line 117, in startup
    server = await loop.create_server(
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1527, in create_server
    server._start_serving()
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 318, in _start_serving
    sock.listen(self._backlog)
OSError: [Errno 98] Address already in use

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 109, in _sentry_receive
    return await receive(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 62, in inner_receive
    message = await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
  File "/usr/local/lib/python3.9/asyncio/queues.py", line 166, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 08:38:13,967.967] INFO [140561035298624] - Stopping reloader process [25]
[2023-01-09 08:38:55,352.352] INFO [140291591464768] - Shutting down
[2023-01-09 08:38:55,561.561] INFO [140291591464768] - Waiting for application shutdown.
[2023-01-09 08:38:55,591.591] ERROR [140291591464768] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 08:38:55,640.640] ERROR [140291591464768] - Application shutdown failed. Exiting.
[2023-01-09 08:38:55,647.647] INFO [140291591464768] - Finished server process [39]
[2023-01-09 08:38:56,819.819] INFO [139874913437504] - Stopping reloader process [1]
[2023-01-09 08:41:08,410.410] INFO [140330106136384] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:41:08,414.414] INFO [140330106136384] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 08:41:08,418.418] INFO [140330106136384] - Started reloader process [1] using StatReload
[2023-01-09 08:41:13,565.565] ERROR [139900558935872] - global
[2023-01-09 08:41:13,565.565] ERROR [139900558935872] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:41:14,044.044] INFO [139900558935872] - Started server process [8]
[2023-01-09 08:41:14,048.048] INFO [139900558935872] - Waiting for application startup.
[2023-01-09 08:41:14,359.359] ERROR [139900558935872] - startup
[2023-01-09 08:41:14,361.361] ERROR [139900558935872] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 08:41:14,395.395] ERROR [139900558935872] - mongo start
[2023-01-09 08:41:14,423.423] ERROR [139900558935872] - routing init
[2023-01-09 08:41:14,769.769] INFO [139900558935872] - Application startup complete.
[2023-01-09 08:42:17,108.108] INFO [139764617353024] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 08:42:17,111.111] ERROR [139764617353024] - [Errno 98] Address already in use
[2023-01-09 08:42:41,678.678] INFO [139900558935872] - 172.24.0.1:61002 - "GET / HTTP/1.1" 404
[2023-01-09 08:42:42,771.771] INFO [139900558935872] - 172.24.0.1:61002 - "GET /favicon.ico HTTP/1.1" 404
[2023-01-09 08:42:53,695.695] INFO [139900558935872] - 172.24.0.1:61016 - "GET /api/openapi HTTP/1.1" 200
[2023-01-09 08:42:54,953.953] INFO [139900558935872] - 172.24.0.1:61016 - "GET /api/openapi.json HTTP/1.1" 200
[2023-01-09 08:43:30,001.001] INFO [139900558935872] - 172.24.0.1:62008 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 08:43:30,084.084] ERROR [139900558935872] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
TypeError: unhashable type: 'AsyncIOMotorClientSession'
[2023-01-09 09:09:12,448.448] INFO [139900558935872] - 172.24.0.1:56132 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:09:12,603.603] ERROR [139900558935872] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
TypeError: unhashable type: 'AsyncIOMotorClientSession'
[2023-01-09 09:13:57,670.670] WARNING [140330106136384] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:13:57,711.711] INFO [139900558935872] - Shutting down
[2023-01-09 09:13:57,837.837] INFO [139900558935872] - Waiting for application shutdown.
[2023-01-09 09:13:57,955.955] ERROR [139900558935872] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:13:58,027.027] ERROR [139900558935872] - Application shutdown failed. Exiting.
[2023-01-09 09:13:58,043.043] INFO [139900558935872] - Finished server process [8]
[2023-01-09 09:14:02,971.971] ERROR [140023988537152] - global
[2023-01-09 09:14:02,972.972] ERROR [140023988537152] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:14:03,317.317] INFO [140023988537152] - Started server process [28]
[2023-01-09 09:14:03,321.321] INFO [140023988537152] - Waiting for application startup.
[2023-01-09 09:14:03,526.526] ERROR [140023988537152] - startup
[2023-01-09 09:14:03,528.528] ERROR [140023988537152] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:14:03,613.613] ERROR [140023988537152] - mongo start
[2023-01-09 09:14:03,659.659] ERROR [140023988537152] - routing init
[2023-01-09 09:14:03,946.946] INFO [140023988537152] - Application startup complete.
[2023-01-09 09:14:10,578.578] INFO [140023988537152] - Shutting down
[2023-01-09 09:14:10,708.708] INFO [140023988537152] - Waiting for application shutdown.
[2023-01-09 09:14:10,735.735] ERROR [140023988537152] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:14:10,778.778] ERROR [140023988537152] - Application shutdown failed. Exiting.
[2023-01-09 09:14:10,790.790] INFO [140023988537152] - Finished server process [28]
[2023-01-09 09:14:12,122.122] INFO [140330106136384] - Stopping reloader process [1]
[2023-01-09 09:17:47,449.449] INFO [140510476678976] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:17:47,463.463] INFO [140510476678976] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:17:47,469.469] INFO [140510476678976] - Started reloader process [1] using StatReload
[2023-01-09 09:17:55,930.930] ERROR [140424707274560] - global
[2023-01-09 09:17:55,937.937] ERROR [140424707274560] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:17:56,514.514] INFO [140424707274560] - Started server process [8]
[2023-01-09 09:17:56,520.520] INFO [140424707274560] - Waiting for application startup.
[2023-01-09 09:17:56,953.953] ERROR [140424707274560] - startup
[2023-01-09 09:17:56,958.958] ERROR [140424707274560] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:17:57,083.083] ERROR [140424707274560] - mongo start
[2023-01-09 09:17:57,118.118] ERROR [140424707274560] - routing init
[2023-01-09 09:17:57,398.398] INFO [140424707274560] - Application startup complete.
[2023-01-09 09:18:34,780.780] INFO [140424707274560] - 172.24.0.1:58898 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:18:34,823.823] ERROR [140424707274560] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
TypeError: unhashable type: 'AsyncIOMotorClientSession'
[2023-01-09 09:19:01,197.197] WARNING [140510476678976] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:19:01,259.259] INFO [140424707274560] - Shutting down
[2023-01-09 09:19:01,389.389] INFO [140424707274560] - Waiting for application shutdown.
[2023-01-09 09:19:01,467.467] ERROR [140424707274560] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:19:01,495.495] ERROR [140424707274560] - Application shutdown failed. Exiting.
[2023-01-09 09:19:01,500.500] INFO [140424707274560] - Finished server process [8]
[2023-01-09 09:19:06,770.770] ERROR [140079043348288] - global
[2023-01-09 09:19:06,772.772] ERROR [140079043348288] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:19:07,348.348] INFO [140079043348288] - Started server process [20]
[2023-01-09 09:19:07,354.354] INFO [140079043348288] - Waiting for application startup.
[2023-01-09 09:19:07,987.987] ERROR [140079043348288] - startup
[2023-01-09 09:19:07,991.991] ERROR [140079043348288] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:19:08,103.103] ERROR [140079043348288] - mongo start
[2023-01-09 09:19:08,194.194] ERROR [140079043348288] - routing init
[2023-01-09 09:19:08,765.765] INFO [140079043348288] - Application startup complete.
[2023-01-09 09:19:15,833.833] INFO [140079043348288] - Shutting down
[2023-01-09 09:19:16,014.014] INFO [140079043348288] - Waiting for application shutdown.
[2023-01-09 09:19:16,022.022] ERROR [140079043348288] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:19:16,083.083] ERROR [140079043348288] - Application shutdown failed. Exiting.
[2023-01-09 09:19:16,110.110] INFO [140079043348288] - Finished server process [20]
[2023-01-09 09:19:16,980.980] INFO [140510476678976] - Stopping reloader process [1]
[2023-01-09 09:30:24,439.439] INFO [140313800648512] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:30:24,444.444] INFO [140313800648512] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:30:24,466.466] INFO [140313800648512] - Started reloader process [1] using StatReload
[2023-01-09 09:30:29,691.691] ERROR [140018404423488] - global
[2023-01-09 09:30:29,692.692] ERROR [140018404423488] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:30:30,264.264] INFO [140018404423488] - Started server process [7]
[2023-01-09 09:30:30,267.267] INFO [140018404423488] - Waiting for application startup.
[2023-01-09 09:30:30,747.747] ERROR [140018404423488] - startup
[2023-01-09 09:30:30,750.750] ERROR [140018404423488] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:30:30,795.795] ERROR [140018404423488] - mongo start
[2023-01-09 09:30:30,841.841] ERROR [140018404423488] - routing init
[2023-01-09 09:30:31,202.202] INFO [140018404423488] - Application startup complete.
[2023-01-09 09:30:38,914.914] WARNING [140313800648512] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:30:39,062.062] INFO [140018404423488] - Shutting down
[2023-01-09 09:30:39,318.318] INFO [140018404423488] - Waiting for application shutdown.
[2023-01-09 09:30:39,813.813] ERROR [140018404423488] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:30:40,002.002] ERROR [140018404423488] - Application shutdown failed. Exiting.
[2023-01-09 09:30:40,022.022] INFO [140018404423488] - Finished server process [7]
[2023-01-09 09:30:48,448.448] ERROR [139711638013760] - global
[2023-01-09 09:30:48,450.450] ERROR [139711638013760] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:30:49,172.172] INFO [139711638013760] - Started server process [18]
[2023-01-09 09:30:49,180.180] INFO [139711638013760] - Waiting for application startup.
[2023-01-09 09:30:49,839.839] ERROR [139711638013760] - startup
[2023-01-09 09:30:49,841.841] ERROR [139711638013760] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:30:49,912.912] ERROR [139711638013760] - mongo start
[2023-01-09 09:30:49,968.968] ERROR [139711638013760] - routing init
[2023-01-09 09:30:50,342.342] INFO [139711638013760] - Application startup complete.
[2023-01-09 09:35:27,930.930] INFO [139711638013760] - 172.24.0.1:59378 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:35:27,992.992] ERROR [139711638013760] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
TypeError: unhashable type: 'AsyncIOMotorClientSession'
[2023-01-09 09:36:03,459.459] WARNING [140313800648512] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:36:04,262.262] INFO [139711638013760] - Shutting down
[2023-01-09 09:36:04,386.386] INFO [139711638013760] - Waiting for application shutdown.
[2023-01-09 09:36:04,644.644] ERROR [139711638013760] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:36:04,898.898] ERROR [139711638013760] - Application shutdown failed. Exiting.
[2023-01-09 09:36:04,920.920] INFO [139711638013760] - Finished server process [18]
[2023-01-09 09:36:10,093.093] ERROR [139803337545536] - global
[2023-01-09 09:36:10,094.094] ERROR [139803337545536] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:36:10,400.400] INFO [139803337545536] - Started server process [30]
[2023-01-09 09:36:10,403.403] INFO [139803337545536] - Waiting for application startup.
[2023-01-09 09:36:10,705.705] ERROR [139803337545536] - startup
[2023-01-09 09:36:10,707.707] ERROR [139803337545536] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:36:10,744.744] ERROR [139803337545536] - mongo start
[2023-01-09 09:36:10,778.778] ERROR [139803337545536] - routing init
[2023-01-09 09:36:11,057.057] INFO [139803337545536] - Application startup complete.
[2023-01-09 09:36:54,351.351] INFO [140110095603520] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:36:54,358.358] INFO [140110095603520] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:36:54,364.364] INFO [140110095603520] - Started reloader process [1] using StatReload
[2023-01-09 09:36:59,067.067] ERROR [139635203176256] - global
[2023-01-09 09:36:59,068.068] ERROR [139635203176256] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:36:59,532.532] INFO [139635203176256] - Started server process [7]
[2023-01-09 09:36:59,536.536] INFO [139635203176256] - Waiting for application startup.
[2023-01-09 09:36:59,966.966] ERROR [139635203176256] - startup
[2023-01-09 09:36:59,969.969] ERROR [139635203176256] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:37:00,034.034] ERROR [139635203176256] - mongo start
[2023-01-09 09:37:00,114.114] ERROR [139635203176256] - routing init
[2023-01-09 09:37:00,713.713] INFO [139635203176256] - Application startup complete.
[2023-01-09 09:38:42,525.525] INFO [139635203176256] - 172.24.0.1:59352 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:38:42,669.669] ERROR [139635203176256] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/usr/src/gate/service/mongo.py", line 132, in get_bookmarks_service
    return BookmarksService(get_mongo_db(), get_mongo_client_session())
  File "/usr/src/gate/service/mongo.py", line 25, in __init__
    self.collection: AsyncIOMotorCollection = self.mongo_db.get_collection(
AttributeError: 'coroutine' object has no attribute 'get_collection'
[2023-01-09 09:41:10,182.182] WARNING [140110095603520] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:41:10,303.303] INFO [139635203176256] - Shutting down
[2023-01-09 09:41:10,434.434] INFO [139635203176256] - Waiting for application shutdown.
[2023-01-09 09:41:10,612.612] ERROR [139635203176256] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:41:10,668.668] ERROR [139635203176256] - Application shutdown failed. Exiting.
[2023-01-09 09:41:10,673.673] INFO [139635203176256] - Finished server process [7]
[2023-01-09 09:41:15,528.528] ERROR [140432050718528] - global
[2023-01-09 09:41:15,528.528] ERROR [140432050718528] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:41:16,180.180] INFO [140432050718528] - Started server process [19]
[2023-01-09 09:41:16,187.187] INFO [140432050718528] - Waiting for application startup.
[2023-01-09 09:41:16,610.610] ERROR [140432050718528] - startup
[2023-01-09 09:41:16,611.611] ERROR [140432050718528] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:41:16,745.745] ERROR [140432050718528] - mongo start
[2023-01-09 09:41:16,799.799] ERROR [140432050718528] - routing init
[2023-01-09 09:41:17,236.236] INFO [140432050718528] - Application startup complete.
[2023-01-09 09:43:31,257.257] INFO [140432050718528] - Shutting down
[2023-01-09 09:43:31,602.602] INFO [140432050718528] - Waiting for application shutdown.
[2023-01-09 09:43:31,732.732] ERROR [140432050718528] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:43:32,360.360] ERROR [140432050718528] - Application shutdown failed. Exiting.
[2023-01-09 09:43:32,381.381] INFO [140432050718528] - Finished server process [19]
[2023-01-09 09:43:33,076.076] INFO [140110095603520] - Stopping reloader process [1]
[2023-01-09 09:45:09,149.149] INFO [140713682204480] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:45:09,154.154] INFO [140713682204480] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:45:09,157.157] INFO [140713682204480] - Started reloader process [1] using StatReload
[2023-01-09 09:45:23,411.411] ERROR [139929732986688] - global
[2023-01-09 09:45:23,427.427] ERROR [139929732986688] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:45:24,402.402] INFO [139929732986688] - Started server process [8]
[2023-01-09 09:45:24,418.418] INFO [139929732986688] - Waiting for application startup.
[2023-01-09 09:45:25,291.291] ERROR [139929732986688] - startup
[2023-01-09 09:45:25,300.300] ERROR [139929732986688] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:45:25,462.462] ERROR [139929732986688] - mongo start
[2023-01-09 09:45:25,575.575] ERROR [139929732986688] - routing init
[2023-01-09 09:45:26,164.164] INFO [139929732986688] - Application startup complete.
[2023-01-09 09:45:46,929.929] INFO [139929732986688] - 172.24.0.1:61328 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:45:47,454.454] ERROR [139929732986688] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/usr/src/gate/service/mongo.py", line 131, in get_bookmarks_service
    return BookmarksService(get_mongo_db(), get_mongo_client_session())
  File "/usr/src/gate/service/mongo.py", line 25, in __init__
    self.collection: AsyncIOMotorCollection = self.mongo_db.get(self.collection_name
AttributeError: 'coroutine' object has no attribute 'get'
[2023-01-09 09:46:10,733.733] WARNING [140713682204480] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:46:10,837.837] INFO [139929732986688] - Shutting down
[2023-01-09 09:46:10,954.954] INFO [139929732986688] - Waiting for application shutdown.
[2023-01-09 09:46:11,078.078] ERROR [139929732986688] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:46:11,101.101] ERROR [139929732986688] - Application shutdown failed. Exiting.
[2023-01-09 09:46:11,113.113] INFO [139929732986688] - Finished server process [8]
[2023-01-09 09:46:18,709.709] ERROR [140699802294080] - global
[2023-01-09 09:46:18,710.710] ERROR [140699802294080] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:46:20,077.077] INFO [140699802294080] - Started server process [20]
[2023-01-09 09:46:20,085.085] INFO [140699802294080] - Waiting for application startup.
[2023-01-09 09:46:21,093.093] ERROR [140699802294080] - startup
[2023-01-09 09:46:21,095.095] ERROR [140699802294080] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:46:21,231.231] ERROR [140699802294080] - mongo start
[2023-01-09 09:46:21,300.300] ERROR [140699802294080] - routing init
[2023-01-09 09:46:22,040.040] INFO [140699802294080] - Application startup complete.
[2023-01-09 09:46:36,397.397] INFO [140699802294080] - Shutting down
[2023-01-09 09:46:36,513.513] INFO [140699802294080] - Waiting for application shutdown.
[2023-01-09 09:46:36,552.552] ERROR [140699802294080] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:46:36,602.602] ERROR [140699802294080] - Application shutdown failed. Exiting.
[2023-01-09 09:46:36,606.606] INFO [140699802294080] - Finished server process [20]
[2023-01-09 09:46:38,266.266] INFO [140713682204480] - Stopping reloader process [1]
[2023-01-09 09:47:23,796.796] INFO [140689594554176] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:47:23,798.798] INFO [140689594554176] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:47:23,804.804] INFO [140689594554176] - Started reloader process [1] using StatReload
[2023-01-09 09:47:28,262.262] ERROR [140322471876416] - global
[2023-01-09 09:47:28,263.263] ERROR [140322471876416] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:47:28,693.693] INFO [140322471876416] - Started server process [9]
[2023-01-09 09:47:28,697.697] INFO [140322471876416] - Waiting for application startup.
[2023-01-09 09:47:29,121.121] ERROR [140322471876416] - startup
[2023-01-09 09:47:29,123.123] ERROR [140322471876416] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:47:29,162.162] ERROR [140322471876416] - mongo start
[2023-01-09 09:47:29,212.212] ERROR [140322471876416] - routing init
[2023-01-09 09:47:29,516.516] INFO [140322471876416] - Application startup complete.
[2023-01-09 09:48:20,610.610] INFO [140322471876416] - 172.24.0.1:59422 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:48:20,931.931] ERROR [140322471876416] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 225, in app
    solved_result = await solve_dependencies(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/dependencies/utils.py", line 535, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/usr/src/gate/service/mongo.py", line 130, in get_bookmarks_service
    return BookmarksService(get_mongo_db(), get_mongo_client_session())
  File "/usr/src/gate/service/mongo.py", line 25, in __init__
    self.collection: AsyncIOMotorCollection = self.mongo_db[self.collection_name]
TypeError: 'coroutine' object is not subscriptable
[2023-01-09 09:49:55,207.207] WARNING [140689594554176] - StatReload detected changes in 'gate/service/mongo.py'. Reloading...
[2023-01-09 09:49:55,367.367] INFO [140322471876416] - Shutting down
[2023-01-09 09:49:55,493.493] INFO [140322471876416] - Waiting for application shutdown.
[2023-01-09 09:49:55,580.580] ERROR [140322471876416] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:49:55,606.606] ERROR [140322471876416] - Application shutdown failed. Exiting.
[2023-01-09 09:49:55,610.610] INFO [140322471876416] - Finished server process [9]
[2023-01-09 09:49:59,319.319] ERROR [140328105908032] - global
[2023-01-09 09:49:59,320.320] ERROR [140328105908032] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:49:59,654.654] INFO [140328105908032] - Started server process [22]
[2023-01-09 09:49:59,663.663] INFO [140328105908032] - Waiting for application startup.
[2023-01-09 09:49:59,982.982] ERROR [140328105908032] - startup
[2023-01-09 09:49:59,985.985] ERROR [140328105908032] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:50:00,071.071] ERROR [140328105908032] - mongo start
[2023-01-09 09:50:00,108.108] ERROR [140328105908032] - routing init
[2023-01-09 09:50:00,314.314] INFO [140328105908032] - Application startup complete.
[2023-01-09 09:50:16,583.583] INFO [140328105908032] - Shutting down
[2023-01-09 09:50:16,870.870] INFO [140328105908032] - Waiting for application shutdown.
[2023-01-09 09:50:17,187.187] ERROR [140328105908032] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:50:18,169.169] ERROR [140328105908032] - Application shutdown failed. Exiting.
[2023-01-09 09:50:18,611.611] INFO [140328105908032] - Finished server process [22]
[2023-01-09 09:50:19,790.790] INFO [140689594554176] - Stopping reloader process [1]
[2023-01-09 09:51:28,465.465] INFO [140181308569408] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:51:28,470.470] INFO [140181308569408] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:51:28,478.478] INFO [140181308569408] - Started reloader process [1] using StatReload
[2023-01-09 09:51:47,595.595] ERROR [140567531812672] - global
[2023-01-09 09:51:47,635.635] ERROR [140567531812672] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:51:48,772.772] INFO [140567531812672] - Started server process [8]
[2023-01-09 09:51:48,799.799] INFO [140567531812672] - Waiting for application startup.
[2023-01-09 09:51:51,530.530] ERROR [140567531812672] - startup
[2023-01-09 09:51:51,540.540] ERROR [140567531812672] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:51:52,675.675] ERROR [140567531812672] - mongo start
[2023-01-09 09:51:52,949.949] ERROR [140567531812672] - routing init
[2023-01-09 09:51:53,612.612] INFO [140567531812672] - Application startup complete.
[2023-01-09 09:51:59,241.241] INFO [140567531812672] - 172.24.0.1:58224 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 500
[2023-01-09 09:51:59,326.326] ERROR [140567531812672] - Exception in ASGI application
Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/protocols/http/h11_impl.py", line 407, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 86, in __call__
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/uvicorn/middleware/message_logger.py", line 82, in __call__
    await self.app(scope, inner_receive, inner_send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/applications.py", line 270, in __call__
    await super().__call__(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 325, in _sentry_patched_asgi_app
    return await middleware(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 139, in _run_asgi3
    return await self._run_app(scope, lambda: self.app(scope, receive, send))
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 188, in _run_app
    raise exc from None
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/asgi.py", line 183, in _run_app
    return await callback()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/applications.py", line 124, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 223, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 75, in __call__
    raise exc
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/middleware/exceptions.py", line 64, in __call__
    await self.app(scope, receive, sender)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/starlette.py", line 130, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 680, in __call__
    await route.handle(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 275, in handle
    await self.app(scope, receive, send)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 65, in app
    response = await func(request)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/sentry_sdk/integrations/fastapi.py", line 107, in _sentry_app
    return await old_app(*args, **kwargs)
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 235, in app
    raw_response = await run_endpoint_function(
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await dependant.call(**values)
  File "/usr/src/gate/api/v1/ugc.py", line 34, in create_bookmark
    await bookmarks_service.create(
AttributeError: 'coroutine' object has no attribute 'create'
[2023-01-09 09:55:24,164.164] INFO [140567531812672] - Shutting down
[2023-01-09 09:55:24,526.526] INFO [140567531812672] - Waiting for application shutdown.
[2023-01-09 09:55:24,765.765] ERROR [140567531812672] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 09:55:24,814.814] ERROR [140567531812672] - Application shutdown failed. Exiting.
[2023-01-09 09:55:24,818.818] INFO [140567531812672] - Finished server process [8]
[2023-01-09 09:55:31,317.317] INFO [140181308569408] - Stopping reloader process [1]
[2023-01-09 09:59:19,604.604] INFO [140199077988160] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 09:59:19,605.605] INFO [140199077988160] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 09:59:19,609.609] INFO [140199077988160] - Started reloader process [1] using StatReload
[2023-01-09 09:59:24,494.494] ERROR [140319521183552] - global
[2023-01-09 09:59:24,495.495] ERROR [140319521183552] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:59:25,081.081] INFO [140319521183552] - Started server process [8]
[2023-01-09 09:59:25,090.090] INFO [140319521183552] - Waiting for application startup.
[2023-01-09 09:59:25,546.546] ERROR [140319521183552] - startup
[2023-01-09 09:59:25,549.549] ERROR [140319521183552] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 09:59:25,680.680] ERROR [140319521183552] - mongo start
[2023-01-09 09:59:25,711.711] ERROR [140319521183552] - routing init
[2023-01-09 09:59:26,178.178] INFO [140319521183552] - Application startup complete.
[2023-01-09 09:59:41,627.627] INFO [140319521183552] - 172.24.0.1:55838 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:00:16,240.240] INFO [140319521183552] - 172.24.0.1:62230 - "GET /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks HTTP/1.1" 200
[2023-01-09 10:00:28,574.574] INFO [140319521183552] - 172.24.0.1:60190 - "DELETE /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/bookmarks?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:00:44,152.152] INFO [140319521183552] - 172.24.0.1:60904 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/likes?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:00:51,830.830] INFO [140319521183552] - 172.24.0.1:59524 - "GET /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/likes HTTP/1.1" 200
[2023-01-09 10:01:02,175.175] INFO [140319521183552] - 172.24.0.1:60602 - "DELETE /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/likes?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:01:20,434.434] INFO [140319521183552] - 172.24.0.1:57590 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/ratings?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9&rating=5 HTTP/1.1" 200
[2023-01-09 10:01:25,917.917] INFO [140319521183552] - 172.24.0.1:59762 - "GET /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/ratings HTTP/1.1" 200
[2023-01-09 10:01:38,254.254] INFO [140319521183552] - 172.24.0.1:55990 - "DELETE /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/ratings?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:02:44,751.751] INFO [140319521183552] - Shutting down
[2023-01-09 10:02:44,928.928] INFO [140319521183552] - Waiting for application shutdown.
[2023-01-09 10:02:46,354.354] ERROR [140319521183552] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 10:02:46,824.824] ERROR [140319521183552] - Application shutdown failed. Exiting.
[2023-01-09 10:02:46,844.844] INFO [140319521183552] - Finished server process [8]
[2023-01-09 10:02:48,618.618] INFO [140199077988160] - Stopping reloader process [1]
[2023-01-09 10:06:13,882.882] INFO [140505655150400] - Will watch for changes in these directories: ['/usr/src']
[2023-01-09 10:06:13,892.892] INFO [140505655150400] - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[2023-01-09 10:06:13,895.895] INFO [140505655150400] - Started reloader process [1] using StatReload
[2023-01-09 10:06:27,193.193] ERROR [140179746240320] - global
[2023-01-09 10:06:27,195.195] ERROR [140179746240320] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 10:06:28,248.248] INFO [140179746240320] - Started server process [7]
[2023-01-09 10:06:28,253.253] INFO [140179746240320] - Waiting for application startup.
[2023-01-09 10:06:28,786.786] ERROR [140179746240320] - startup
[2023-01-09 10:06:28,811.811] ERROR [140179746240320] - environ({'PATH': '/home/gatekeeper/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', 'HOSTNAME': 'gate_api', 'KAFKA_HOST': 'kafka', 'KAFKA_PORT': '9092', 'KAFKA_BATCH_SIZE': '10000000', 'KAFKA_CONSUMER_GROUP_ID': '2f336a37-4986-4a6e-86d0-58b384993f97', 'KAFKA_WATCHING_PROGRESS_TOPIC': 'watching_progress', 'SENTRY_DSN': '', 'MONGODB_HOST': 'mongors1n1', 'MONGODB_PORT': '27017', 'LANG': 'C.UTF-8', 'GPG_KEY': 'E3FF2839C048B25C084DEBE9B26995E310250568', 'PYTHON_VERSION': '3.9.16', 'PYTHON_PIP_VERSION': '22.0.4', 'PYTHON_SETUPTOOLS_VERSION': '58.1.0', 'PYTHON_GET_PIP_URL': 'https://github.com/pypa/get-pip/raw/66030fa03382b4914d4c4d0896961a0bdeeeb274/public/get-pip.py', 'PYTHON_GET_PIP_SHA256': '1e501cf004eac1b7eb1f97266d28f995ae835d30250bec7f8850562703067dc6', 'USER': 'gatekeeper', 'GROUP': 'gatekeeper', 'HOMEDIR': '/home/gatekeeper', 'APP_HOME': '/usr/src', 'APP_REQUIREMENTS': '/usr/requirements', 'PYTHONPATH': '/usr/src/gate:', 'HOME': '/home/gatekeeper'})
[2023-01-09 10:06:29,794.794] ERROR [140179746240320] - mongo start
[2023-01-09 10:06:29,999.999] ERROR [140179746240320] - routing init
[2023-01-09 10:06:30,658.658] INFO [140179746240320] - Application startup complete.
[2023-01-09 10:06:33,210.210] INFO [140179746240320] - 172.24.0.1:62826 - "POST /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/ratings?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9&rating=5 HTTP/1.1" 200
[2023-01-09 10:06:38,846.846] INFO [140179746240320] - 172.24.0.1:60656 - "DELETE /api/v1/feedback/5d7539da-300a-4305-8166-2b44018ac5e9/ratings?movie_id=5d7539da-300a-4305-8166-2b44018ac5e9 HTTP/1.1" 200
[2023-01-09 10:06:56,985.985] INFO [140179746240320] - Shutting down
[2023-01-09 10:06:57,094.094] INFO [140179746240320] - Waiting for application shutdown.
[2023-01-09 10:06:57,102.102] ERROR [140179746240320] - Traceback (most recent call last):
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 648, in lifespan
    await receive()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 543, in __aexit__
    await self._router.shutdown()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/starlette/routing.py", line 632, in shutdown
    await handler()
  File "/usr/src/./gate/main.py", line 59, in shutdown_event
    await mng_db.aio_mongo_client.end_session()
  File "/home/gatekeeper/.local/lib/python3.9/site-packages/motor/core.py", line 743, in __call__
    raise TypeError(
TypeError: MotorDatabase object is not callable. If you meant to call the 'end_session' method on a AsyncIOMotorClient object it is failing because no such method exists.

[2023-01-09 10:06:57,126.126] ERROR [140179746240320] - Application shutdown failed. Exiting.
[2023-01-09 10:06:57,132.132] INFO [140179746240320] - Finished server process [7]
[2023-01-09 10:06:58,213.213] INFO [140505655150400] - Stopping reloader process [1]
